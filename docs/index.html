<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2020-08-07 Fri 17:53 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Direct-Lighting on Vulkan and Performance Analysis</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Hee Hwang" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<style>pre.src, pre.src-C {font-family: "Roboto Mono", Courier, monospace; font-weight:300; background-color: #303030; color: #e5e5e5;}</style>
<style>body {font-family: "Cambria", "Georgia", sans-serif; }</style>
<style> body {padding: 100px; width: 1000px; margin: auto; text-align: left;font-weight: 300; font-family: 'Open Sans', sans-serif; color: #121212; }
<style> h1, h2, h3, h4 { font-family: 'Source Sans Pro', sans-serif;}
<style> code1 { background-color: #ffd100; border-radius: 3px; font-family: courier, monospace; padding: 0 3px;} </style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2019 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Direct-Lighting on Vulkan and Performance Analysis</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org40229d5">Week1</a>
<ul>
<li><a href="#org49ea4a7">Title, Summary and Team Members</a></li>
<li><a href="#org5b594b2">Problem Description</a></li>
<li><a href="#org22bee8d">Goals and Deliverables(Original)</a>
<ul>
<li><a href="#orgb449d24">Global illumination that supports GPU processing</a></li>
<li><a href="#org60c08db">Parallel logic implementation</a></li>
<li><a href="#org6e276c5">Performance Comparison</a></li>
<li><a href="#orgb2a8583">Additional Shaders using Different Lighting</a></li>
</ul>
</li>
<li><a href="#orge67e38b">Schedule(Original)</a></li>
</ul>
</li>
<li><a href="#orgf7976ed">Week2</a>
<ul>
<li><a href="#org953af94">Status</a>
<ul>
<li><a href="#orgfe9a712">Framework Selection</a></li>
<li><a href="#org3913cda">shadertoy.com</a></li>
<li><a href="#org60664e4">Ray Tracing vs. Ray Marching</a></li>
</ul>
</li>
<li><a href="#orgec25899">Adaptation &amp; Changes</a>
<ul>
<li><a href="#org896535f"><span class="todo TODO">TODO</span> Part 1: Local shadertoy.com and Vulkan graphics pipeline</a></li>
<li><a href="#org441642a"><span class="todo TODO">TODO</span> Part 2: Ray Tracing &amp; Ray Marching Performance Analysis</a></li>
<li><a href="#orgc2d3924"><span class="todo TODO">TODO</span> Part 3: Real-Time Global Illumination</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgbc41705">Resources</a>
<ul>
<li><a href="#orgecee6cc">Computing platform</a></li>
<li><a href="#orgd8493d0">Online materials</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org40229d5" class="outline-2">
<h2 id="org40229d5">Week1</h2>
<div class="outline-text-2" id="text-org40229d5">
</div>
<div id="outline-container-org49ea4a7" class="outline-3">
<h3 id="org49ea4a7">Title, Summary and Team Members</h3>
<div class="outline-text-3" id="text-org49ea4a7">
<p>
This project improves the performance of the previous raytracing projects written in OpenGL. This project utilizes modern GPU
technology and significantly shorten the rendering time. The work is done individually.
</p>
</div>
</div>

<div id="outline-container-org5b594b2" class="outline-3">
<h3 id="org5b594b2">Problem Description</h3>
<div class="outline-text-3" id="text-org5b594b2">
<p>
The previous OpenGL-based raytracer's problem is that it only uses CPUs whose performance is capped on the limited number of cores.  A simple global illumination rendering takes several minutes, and this could be problematic when rendering complex scenes.  Currently, all logics in the previous project assume we use
CPUs, which means a fair amount of code must be optimized and rewritten. I will implement a vanilla raytracer using the previous project, 
<i>PathTracer<sup><a id="fnr.1" class="footref" href="#fn.1">1</a></sup>,</i> and <i>Apple Metal Performance Shader<sup><a id="fnr.2" class="footref" href="#fn.2">2</a></sup></i>. In a
nutshell, I will optimize and rewrite raytracing logics that push the GPU to its maximum limit.
</p>
</div>
</div>

<div id="outline-container-org22bee8d" class="outline-3">
<h3 id="org22bee8d">Goals and Deliverables(Original)</h3>
<div class="outline-text-3" id="text-org22bee8d">
</div>
<div id="outline-container-orgb449d24" class="outline-4">
<h4 id="orgb449d24">Global illumination that supports GPU processing</h4>
<div class="outline-text-4" id="text-orgb449d24">
<p>
Apple Metal Shader requires us to write code in either objective-c
or swift, which means that I have to implement a path tracer from scratch. I will use OpenGL if this plan is not feasible in the given timeline.
</p>
</div>
</div>

<div id="outline-container-org60c08db" class="outline-4">
<h4 id="org60c08db">Parallel logic implementation</h4>
<div class="outline-text-4" id="text-org60c08db">
<p>
In the previous project, we process pixels by pixels to compute the spectrum on the pixel, an iterative process. I will setup BVH as a readable GPU buffer. The tricky part is to remove recursion in global illumination. This part is something that I need to figure out later.
</p>
</div>
</div>

<div id="outline-container-org6e276c5" class="outline-4">
<h4 id="org6e276c5">Performance Comparison</h4>
<div class="outline-text-4" id="text-org6e276c5">
<p>
I will present the program's performance by measuring the rendering speedup and memory usage with increasing complexity. A
table and chart will be provided.
</p>
</div>
</div>

<div id="outline-container-orgb2a8583" class="outline-4">
<h4 id="orgb2a8583">Additional Shaders using Different Lighting</h4>
<div class="outline-text-4" id="text-orgb2a8583">
<p>
After improving the path tracer, I want to change lighting using different shaders.
This task is something that I hope to deliver at the end of the semester.
</p>
</div>
</div>
</div>

<div id="outline-container-orge67e38b" class="outline-3">
<h3 id="orge67e38b">Schedule(Original)</h3>
<div class="outline-text-3" id="text-orge67e38b">
<ul class="org-ul">
<li>Week1(8/1/2020 - 8/7/2020): Implement vanilla path tracer without GPU acceleration</li>
<li>Week2(8/8/2020 - 8/14/2020): Add parallel logic, measure performance, and implement additional lighting</li>
</ul>
</div>
</div>
</div>



<div id="outline-container-orgf7976ed" class="outline-2">
<h2 id="orgf7976ed">Week2</h2>
<div class="outline-text-2" id="text-orgf7976ed">
</div>
<div id="outline-container-org953af94" class="outline-3">
<h3 id="org953af94">Status</h3>
<div class="outline-text-3" id="text-org953af94">
</div>
<div id="outline-container-orgfe9a712" class="outline-4">
<h4 id="orgfe9a712">Framework Selection</h4>
<div class="outline-text-4" id="text-orgfe9a712">
<p>
Initially, I was planning to implement a raytracer using the Apple Metal performance shader. However, it turned out that the Metal shader internally applied a ray intersection and bounding volume hierarchy.
It would be suitable for rendering, but bad for learning.
Worse yet, trying to understand the logic of a new language is time-consuming.  Lastly, the Metal is not cross-platform, which traps me in one operating system.  For this reason, I decided to work on
Vulkan. The tutorial<sup><a id="fnr.3" class="footref" href="#fn.3">3</a></sup> is very well written, and I was able to render a
simple scene using a fragment shader.
</p>

<div class="figure">
<p><img src="./images/sphere.png" alt="sphere.png" />
</p>
<p><span class="figure-number">Figure 1: </span>3D images using a fragment shader</p>
</div>
</div>
</div>


<div id="outline-container-org3913cda" class="outline-4">
<h4 id="org3913cda">shadertoy.com</h4>
<div class="outline-text-4" id="text-org3913cda">
<p>
As TA suggested, I began to dig shadertoy.com, especially following direct lighting examples.
</p>


<div class="figure">
<p><img src="./images/mis.png" alt="mis.png" />
</p>
<p><span class="figure-number">Figure 2: </span>Direct-Lighting with multiple importance sampling</p>
</div>

<p>
I was amazed by this example because the lighting happens in real-time.  I was curious about how this is possible.  First, It turned out that the author hard-coded relatively simple objects into the fragment shader directly. It contains only three spheres and one box, and No bounding volume hierarchy was necessary.  Secondly, it samples only one ray per pixel. As I increased the number of samples to 10, it became unbearably slow. Nevertheless, these examples are so different from what
we covered in class, and I became interested in shader-only
rendering. Because the shader toy does not give me control over the rendering engine, I decided to implement the local version using
Vulkan.
</p>
</div>
</div>

<div id="outline-container-org60664e4" class="outline-4">
<h4 id="org60664e4">Ray Tracing vs. Ray Marching</h4>
<div class="outline-text-4" id="text-org60664e4">
<p>
I also came across a different lighting algorithm, ray marching from <a href="https://www.shadertoy.com/view/lsVBRc">https://www.shadertoy.com/view/lsVBRc</a> What's the difference between ray tracing and ray marching?  Ray tracing usually performs better when you have a large number of primitives.  (CPU does an excellent
job on this) On the other hand, ray marching typically computes less operation per intersection, which is useful for parallelization.  If the data structure is a signed distance field<sup><a id="fnr.4" class="footref" href="#fn.4">4</a></sup>, it will take constant time and non-divergent.  My goal is to compare their performance and grasp what they are capable of.  For example, is raymarching good at volumic objects?
</p>
</div>
</div>
</div>

<div id="outline-container-orgec25899" class="outline-3">
<h3 id="orgec25899">Adaptation &amp; Changes</h3>
<div class="outline-text-3" id="text-orgec25899">
</div>
<div id="outline-container-org896535f" class="outline-4">
<h4 id="org896535f"><span class="todo TODO">TODO</span> Part 1: Local shadertoy.com and Vulkan graphics pipeline</h4>
<div class="outline-text-4" id="text-org896535f">
<p>
I want to grasp how the Vulkan graphics pipeline works. To do that, I will implement a local version of shadertoy.com using Vulkan. Vulkan is very verbose, meaning that it contains tons of boilerplate that gives developers so much control. I will explore more and deliver what I have learned.
The local version must compile and execute vertex and fragment shader.
</p>
</div>
</div>


<div id="outline-container-org441642a" class="outline-4">
<h4 id="org441642a"><span class="todo TODO">TODO</span> Part 2: Ray Tracing &amp; Ray Marching Performance Analysis</h4>
<div class="outline-text-4" id="text-org441642a">
<p>
This part contains the implementation of ray tracing and raymarching on a fragment shader.
I will compare ray tracing and ray marching with different objects. (Direct lighting) 
CPU and GPU utilization will be analyzed, as well.
</p>
</div>
</div>

<div id="outline-container-orgc2d3924" class="outline-4">
<h4 id="orgc2d3924"><span class="todo TODO">TODO</span> Part 3: Real-Time Global Illumination</h4>
<div class="outline-text-4" id="text-orgc2d3924">
<p>
If time permits, I will try real-time global illumination with a complex object(bunny) on Vulkan.
Currently, I find an algorithm that could utilize the GPU.
</p>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbc41705" class="outline-2">
<h2 id="orgbc41705">Resources</h2>
<div class="outline-text-2" id="text-orgbc41705">
</div>
<div id="outline-container-orgecee6cc" class="outline-3">
<h3 id="orgecee6cc">Computing platform</h3>
<div class="outline-text-3" id="text-orgecee6cc">
<ul class="org-ul">
<li>Macbook Pro(2019)</li>
<li>CPU: 2.6 GHz 6-Core Intel Core i7</li>
<li>RAM: 16 GB 2667 MHz DDR4</li>
<li>GPU: AMD Radeon Pro 5300M 4 GB</li>
</ul>
</div>
</div>
<div id="outline-container-orgd8493d0" class="outline-3">
<h3 id="orgd8493d0">Online materials</h3>
<div class="outline-text-3" id="text-orgd8493d0">
<ul class="org-ul">
<li>Vulkan Tutorial <a href="https://vulkan-tutorial.com/Introduction">https://vulkan-tutorial.com/Introduction</a></li>
<li>OpenGL Pathtracer Implemetation <a href="https://cal-cs184-student.github.io/p3-1-pathtracer-su20-heeh/">https://cal-cs184-student.github.io/p3-1-pathtracer-su20-heeh/</a></li>
<li>Apple Metal Shader <a href="https://developer.apple.com/documentation/metalperformanceshaders/metal_for_accelerating_ray_tracing">https://developer.apple.com/documentation/metalperformanceshaders/metal_for_accelerating_ray_tracing</a></li>
<li>Direct Lighting MIS <a href="https://www.shadertoy.com/view/MsXfz4">https://www.shadertoy.com/view/MsXfz4</a></li>
</ul>
</div>
</div>
</div>
<div id="footnotes">
<h2 class="footnotes">Footnotes: </h2>
<div id="text-footnotes">

<div class="footdef"><sup><a id="fn.1" class="footnum" href="#fnr.1">1</a></sup> <div class="footpara"><p class="footpara">
<a href="https://cal-cs184-student.github.io/p3-1-pathtracer-su20-heeh/">https://cal-cs184-student.github.io/p3-1-pathtracer-su20-heeh/</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.2" class="footnum" href="#fnr.2">2</a></sup> <div class="footpara"><p class="footpara">
<a href="https://developer.apple.com/documentation/metalperformanceshaders/metal_for_accelerating_ray_tracing">https://developer.apple.com/documentation/metalperformanceshaders/metal_for_accelerating_ray_tracing</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.3" class="footnum" href="#fnr.3">3</a></sup> <div class="footpara"><p class="footpara">
<a href="https://vulkan-tutorial.com/Introduction">https://vulkan-tutorial.com/Introduction</a>
</p></div></div>

<div class="footdef"><sup><a id="fn.4" class="footnum" href="#fnr.4">4</a></sup> <div class="footpara"><p class="footpara">
<a href="https://en.wikipedia.org/wiki/Signed_distance_function">https://en.wikipedia.org/wiki/Signed_distance_function</a>
</p></div></div>


</div>
</div></div>
<div id="postamble" class="status">
<p class="date">Date: 2020-08-07 Fri 00:00</p>
<p class="author">Author: Hee Hwang</p>
<p class="date">Created: 2020-08-07 Fri 17:53</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
